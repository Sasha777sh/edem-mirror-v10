# üßæ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è –∫–æ–¥–µ—Ä–∞

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π –¥–∏–∞–ª–æ–≥–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã (Shadow ‚Üí Truth ‚Üí Integration) —Å RAG-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã EDEM.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1. Staging-–æ–∫—Ä—É–∂–µ–Ω–∏–µ

- –ü–æ–¥–Ω—è—Ç—å —Å—Ç–µ–∫: Supabase + Next.js
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é –ë–î –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –í–∫–ª—é—á–∏—Ç—å —Ñ–∏—á–∞-—Ñ–ª–∞–≥ `mirror_v2` –≤ PostHog —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–µ—Ä–æ–≤

### 2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (pgvector)

–°–æ–∑–¥–∞—Ç—å 4 —Ç–∞–±–ª–∏—Ü—ã:

#### rag_chunks (–∫–æ—Ä–ø—É—Å –∑–Ω–∞–Ω–∏–π)

```sql
create table rag_chunks (
  id uuid primary key default gen_random_uuid(),
  title text,
  stage text[] check (stage <@ array['shadow','truth','integration']),
  symptom text[] default '{}',
  archetype text[] default '{}',
  modality text[] default '{}',
  lang text default 'ru',
  text text not null,
  embedding vector(1536)
);
```

#### prompt_versions (—à–∞–±–ª–æ–Ω—ã –≥–æ–ª–æ—Å–æ–≤)

```sql
create table prompt_versions (
  id uuid primary key default gen_random_uuid(),
  name text,
  stage text check (stage in ('shadow','truth','integration')),
  content text,
  is_active boolean default true,
  created_at timestamptz default now()
);
```

#### session_state (—Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞)

```sql
create table session_states (
  id uuid primary key default gen_random_uuid(),
  user_id uuid,
  session_id uuid,
  stage text check (stage in ('shadow','truth','integration')) default 'shadow',
  defensiveness int default 0,
  acknowledgement int default 0,
  readiness int default 0,
  shadow_streak int default 0,
  updated_at timestamptz default now()
);
```

#### practices (–ø—Ä–∞–∫—Ç–∏–∫–∏ + —á–µ–∫-–∏–Ω—ã)

```sql
create table practices (
  id uuid primary key default gen_random_uuid(),
  user_id uuid,
  session_id uuid,
  practice_key text,
  assigned_at timestamptz default now(),
  due_at timestamptz,
  done boolean default false,
  self_report int,
  note text
);
```

### 3. –ö–æ—Ä–ø—É—Å –∑–Ω–∞–Ω–∏–π

–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å 20+ –∫–∞—Ä—Ç–æ—á–µ–∫ –ø–æ —Ç–µ–º–∞–º:

- –¢—Ä–µ–≤–æ–≥–∞ (anxiety)
- –†–∞—Å—Å—Ç–∞–≤–∞–Ω–∏–µ (breakup)
- –°–æ–Ω (sleep)
- –ì–Ω–µ–≤ (anger)

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤ —Ä–µ–ø–æ:

```
/corpus
  /glossary      # —Å–ª–æ–≤–∞—Ä—å –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤/—Ç–µ–Ω–µ–π
  /protocols     # –º–∏–∫—Ä–æ-–ø—Ä–∞–∫—Ç–∏–∫–∏ ‚â§3 –º–∏–Ω
  /maps          # –ø–µ—Ä–µ—Ö–æ–¥: –ø–∞—Ç—Ç–µ—Ä–Ω ‚Üí –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å
  /cases         # –∫–æ—Ä–æ—Ç–∫–∏–µ –∫–µ–π—Å—ã "–±—ã–ª–æ/—Å—Ç–∞–ª–æ"
  /ethics        # –≥—Ä–∞–Ω–∏—Ü—ã, –∫—Ä–∏–∑–∏—Å-—Å–∫—Ä–∏–ø—Ç—ã
```

### 4. API /api/chat

–≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–æ–ª–∂–µ–Ω:

- –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∑–∞—â–∏—Ç–∞, –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ, –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å)
- –í—ã–±–∏—Ä–∞—Ç—å —Å—Ç–∞–¥–∏—é (Shadow/Truth/Integration)
- –ü–æ–¥—Ç—è–≥–∏–≤–∞—Ç—å 1‚Äì2 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –∫—É—Å–∫–∞ –∏–∑ RAG
- –û—Ç–≤–µ—á–∞—Ç—å –ø–æ —à–∞–±–ª–æ–Ω—É –∏–∑ prompt_versions

### 5. API /api/checkin

- –ß–µ—Ä–µ–∑ 24 —á–∞—Å–∞ –ø–æ—Å–ª–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∞–∫—Ç–∏–∫–∏ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç: ¬´–°–¥–µ–ª–∞–ª –ª–∏ –ø—Ä–∞–∫—Ç–∏–∫—É? 0‚Äì10¬ª
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Ç–≤–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ practices

### 6. PostHog-—Å–æ–±—ã—Ç–∏—è

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç—Ä–µ–∫–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π:

- `stage_change`
- `practice_assigned`
- `practice_done`

### 7. SOS-—Ä–µ–∂–∏–º

–ï—Å–ª–∏ —Ç–µ–∫—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∫—Ä–∏–∑–∏—Å–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞, –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∑–∞—à–∏—Ç—ã–π –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ—Ç–≤–µ—Ç —Å –Ω–æ–º–µ—Ä–∞–º–∏ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π –ø–æ–º–æ—â–∏.

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

‚úÖ **–ì–æ—Ç–æ–≤–æ**:

- [x] –ß–∞—Ç —Ä–µ–∞–ª—å–Ω–æ –≤–µ–¥—ë—Ç –ø–æ —Ç—Ä—ë–º —Å—Ç–∞–¥–∏—è–º
- [x] –ú–æ–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ –ø—Ä–∏–º–µ—Ä: ¬´–ú–Ω–µ —Ç—Ä–µ–≤–æ–∂–Ω–æ¬ª ‚Üí –±–æ—Ç –Ω–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–Ω—å ‚Üí –ø–æ—Ç–æ–º –ø—Ä–∞–≤–¥—É ‚Üí –ø–æ—Ç–æ–º –¥–∞—ë—Ç –º–∏–∫—Ä–æ-–ø—Ä–∞–∫—Ç–∏–∫—É
- [x] –ù–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å –ø—Ä–∏—Ö–æ–¥–∏—Ç ¬´—á–µ–∫-–∏–Ω¬ª
- [x] –í –∞–¥–º–∏–Ω–∫–µ (Supabase/PostHog) –≤–∏–¥–Ω—ã —Å–æ–±—ã—Ç–∏—è stage_change –∏ practice_done

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

1. [x] –ü–æ–¥–Ω—è—Ç–æ staging-–æ–∫—Ä—É–∂–µ–Ω–∏–µ (Supabase + Next.js)
2. [x] –í–∫–ª—é—á—ë–Ω pgvector –∏ —Å–æ–∑–¥–∞–Ω—ã 4 —Ç–∞–±–ª–∏—Ü—ã
3. [x] –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã 20+ –∫–∞—Ä—Ç–æ—á–µ–∫ –ø–æ —Ç–µ–º–∞–º —Ç—Ä–µ–≤–æ–≥–∞, —Ä–∞—Å—Å—Ç–∞–≤–∞–Ω–∏–µ, —Å–æ–Ω
4. [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω /api/chat —Å –∞–Ω–∞–ª–∏–∑–æ–º —Å–∏–≥–Ω–∞–ª–æ–≤ –∏ —Å—Ç–∞–¥–∏–π
5. [x] –ù–∞—Å—Ç—Ä–æ–µ–Ω PostHog —Å —Å–æ–±—ã—Ç–∏—è–º–∏ stage_change, practice_assigned, practice_done
6. [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω SOS-—Ä–µ–∂–∏–º –¥–ª—è –∫—Ä–∏–∑–∏—Å–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π
7. [x] –°–æ–∑–¥–∞–Ω—ã —à–∞–±–ª–æ–Ω—ã –¥–ª—è —Ç—Ä—ë—Ö –≥–æ–ª–æ—Å–æ–≤ (Shadow/Truth/Integration)

### ‚è≥ –í –ø—Ä–æ—Ü–µ—Å—Å–µ

1. [ ] –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π /api/checkin (—á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–∞—Ä–∫–∞—Å)

### üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –°–∏—Å—Ç–µ–º–∞ —É–∂–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- –û—Å—Ç–∞–ª–æ—Å—å –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —á–µ–∫-–∏–Ω–æ–≤ —á–µ—Ä–µ–∑ cron-–∑–∞–¥–∞—á–∏
- –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
